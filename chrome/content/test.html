<html>

<head>
<style>
img { margin: 4px; border: 3px #f00 solid }
</style>
</head>

<body>
<script>

const Cc = Components.classes;
const Ci = Components.interfaces;
const Cu = Components.utils;

Cu.import ('resource://shrunked/shrunked.jsm');

var ioService = Cc ['@mozilla.org/network/io-service;1'].getService (Ci.nsIIOService2);

try {
	var sourceDir = Cc ["@mozilla.org/file/local;1"].createInstance (Ci.nsILocalFile);
	sourceDir.initWithPath ('C:\\Users\\Geoff\\AppData\\Roaming\\Mozilla\\Extensions\\shrunked@darktrojan.net\\chrome\\content');

	Shrunked.document = document;
	doIt ('bitmap1.jpg', 300); // 3.33
	doIt ('bitmap2.jpg', 400); // 2.5
	doIt ('bitmap3.jpg', 750); // 1.33

} catch (e) {
	alert (e);
}

function doIt (f, s) {
	var sourceFile = sourceDir.clone ();
	sourceFile.append (f);
	Shrunked.enqueue (document, sourceFile, s, s, 75, function (destFile) {
		var h = Image ();
		h.setAttribute ('style', 'max-width: ' + s + 'px; max-height: ' + s + 'px');
		h.src = ioService.newFileURI (sourceFile).spec;
		document.body.appendChild (h);
		var i = Image ();
		i.src = ioService.newFileURI (destFile).spec;
		document.body.appendChild (i);
		document.body.appendChild (document.createElement ('br'));
	});
}

</script>
</body>

</html>
